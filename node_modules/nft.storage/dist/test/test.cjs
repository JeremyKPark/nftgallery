'use strict';

var mockServer = require('./mock-server.cjs');
var service = require('./service.cjs');
var child_process = require('child_process');

const main = async () => {
  const [, , command, ...args] = process.argv;
  const AUTH_TOKEN = Math.random().toString(32).slice(2);

  const service$1 = await mockServer.activate(service.init(AUTH_TOKEN), service.handle);

  console.log(`Mock service running on: ${service$1.url}`);

  const test = child_process.spawn(`${command}`, args, {
    stdio: 'inherit',
    env: {
      ...process.env,
      AUTH_TOKEN,
      SERVICE_ENDPOINT: `${service$1.url}`,
    },
  });

  const code = await new Promise((resolve) =>
    test.once('exit', (code) => resolve(code))
  );

  mockServer.deactivate(service$1);
  process.exit(code);
};

main();
//# sourceMappingURL=test.cjs.map
